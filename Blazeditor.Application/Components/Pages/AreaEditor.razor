@page "/area/{areaId:int}"
@attribute [Authorize]

@using Blazeditor.Application.Components.Dialogs
@using Blazeditor.Application.Services
@using Microsoft.AspNetCore.Authorization
@using Microsoft.JSInterop
@inject DefinitionManager Definition
@inject IJSRuntime JS

<div class="area-editor-layout">
    <div class="area-editor-canvas">
        @if (Area != null)
        {
            <TileMapCanvas @ref="TileMapCanvas" Area="@Area" SelectedTile="SelectedTile" ActiveLayer="@ActiveLayer" />
        }
    </div>
    <div class="area-editor-sidebar">
        <h2 class="area-editor-title">@Area?.Name</h2>
        @if (Definition.IsDirty)
        {
            <div class="alert alert-warning d-flex align-items-center py-1 px-2 mb-2">
                <i class="bi bi-exclamation-circle me-2"></i>
                <span>Unsaved changes</span>
                <button class="btn btn-sm btn-primary ms-auto" @onclick="async () => await SaveDefinitionAsync()">
                    <i class="bi bi-save"></i> Save
                </button>
            </div>
        }
        @if (Area != null)
        {
            <div class="mb-3">
                <label for="paletteSelect" class="form-label">Tile Palette</label>
                <select id="paletteSelect" class="form-select" @onchange="OnPaletteChanged" value="@selectedPaletteId">
                    <option value="">-- Select Palette --</option>
                    @foreach (var palette in Definition.GetTilePalettes())
                    {
                        <option value="@palette.Id" selected="@(selectedPaletteId == palette.Id)">@palette.Name</option>
                    }
                </select>
            </div>
            <TilePaletteCanvas @ref=TilePaletteCanvas Area="@Area" SelectedPaletteId="@selectedPaletteId" OnTileSelected="OnTileSelected" />
            <MapLayerSelector Layers="Area.TileMaps" ActiveLayer="@ActiveLayer" OnLayerSelected="OnLayerSelected" OnRemoveLayer="OnRemoveLayer" OnAddLayer="OnAddLayer" />
            @if (SelectedTile != null)
            {
                <div class="area-editor-selected-tile">
                    <h3>@SelectedTile.Name</h3>
                    <div class="area-editor-selected-tile-control">
                        <img src="@SelectedTile.Image" alt="@SelectedTile.Description" />
                        <button class="btn btn-danger mt-2" @onclick="async () => await DeleteSelectedTile()"><i class="bi bi-trash"></i> Delete Tile</button>
                    </div>
                </div>
            }
        }
    </div>
</div>

@code {


}

