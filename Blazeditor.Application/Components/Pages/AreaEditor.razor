@page "/area/{areaId:int}"
@attribute [Authorize]

@using Blazeditor.Application.Components.Dialogs
@using Blazeditor.Application.Services
@using Microsoft.AspNetCore.Authorization
@using Microsoft.JSInterop
@inject DefinitionManager Definition
@inject IJSRuntime JS

<div class="area-editor-layout">
    <div class="area-editor-canvas">
        @if (Area != null)
        {
            <TileMapCanvas @ref="TileMapCanvas" Area="@Area" SelectedTileId="@(SelectedTile != null ? SelectedTile.Id : -1)" ActiveLevel="@ActiveLevel" />
        }
    </div>
    <div class="area-editor-sidebar">
        <h2 class="area-editor-title">@Area?.Name</h2>
        @if (Definition.IsDirty)
        {
            <div class="alert alert-warning d-flex align-items-center py-1 px-2 mb-2">
                <i class="bi bi-exclamation-circle me-2"></i>
                <span>Unsaved changes</span>
                <button class="btn btn-sm btn-primary ms-auto" @onclick="async () => await SaveDefinitionAsync()">
                    <i class="bi bi-save"></i> Save
                </button>
            </div>
        }
        @if (Area != null)
        {
            <TilePaletteCanvas @ref=TilePaletteCanvas Area="@Area" OnTileSelected="OnTileSelected" OnPaletteImport="OnPaletteImport" />
            <MapLevelSelector Levels="Area.TileMaps" ActiveLevel="@ActiveLevel" OnLevelSelected="OnLevelSelected" OnRemoveLevel="OnRemoveLevel" OnAddLevel="OnAddLevel" />
            @if (SelectedTile != null)
            {
                <div class="area-editor-selected-tile">
                    <h3>@SelectedTile.Name</h3>
                    <div class="area-editor-selected-tile-control">
                        <img src="@SelectedTile.Image" alt="@SelectedTile.Description" />
                        <button class="btn btn-danger mt-2" @onclick="async () => await DeleteSelectedTile()"><i class="bi bi-trash"></i> Delete Tile</button>
                    </div>
                </div>
            }
        }
    </div>
</div>

